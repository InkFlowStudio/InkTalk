<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>InkTalk</title>
  <style>
    :root { color-scheme: light dark; --bg:#0b0b0c; --panel:#131316; --text:#eaeaf0; --muted:#9aa1a9; --accent:#7c5cff; --border:#22222a; }
    html,body { margin:0; height:100%; background:linear-gradient(180deg,#0a0a0b, #111119); color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial; }
    .wrap { max-width:900px; margin:0 auto; padding:16px; }
    header { display:flex; align-items:center; gap:12px; padding:12px 0; }
    header h1 { margin:0; font-size:20px; letter-spacing:.4px; }
    .badge { font-size:12px; color:var(--muted); border:1px solid var(--border); padding:2px 8px; border-radius:999px; }
    .panel { background:var(--panel); border:1px solid var(--border); border-radius:12px; overflow:hidden; }
    .messages { height:60vh; overflow:auto; padding:16px; display:flex; flex-direction:column; gap:14px; scroll-behavior:smooth; }
    .msg { display:flex; gap:12px; }
    .role { width:28px; height:28px; display:grid; place-items:center; border-radius:8px; background:#1a1a22; border:1px solid var(--border); font-size:12px; color:var(--muted); }
    .bubble { flex:1; background:#151520; border:1px solid var(--border); padding:12px 14px; border-radius:10px; white-space:pre-wrap; line-height:1.45; }
    .user .bubble { background:#111118; }
    .assistant .bubble { background:#151520; }
    .toolbar { display:flex; gap:8px; padding:10px; border-top:1px solid var(--border); background:#0f0f15; }
    select, button, textarea, input { background:#12121a; color:var(--text); border:1px solid var(--border); border-radius:8px; }
    select, button { height:40px; padding:0 10px; }
    textarea { flex:1; min-height:40px; max-height:140px; padding:10px; resize:vertical; }
    button.primary { background:linear-gradient(180deg,#7c5cff,#5e46ff); border:0; }
    .muted { color:var(--muted); font-size:12px; }
    .footer { margin-top:8px; display:flex; justify-content:space-between; gap:8px; align-items:center; }
    .link { color:#a99cff; text-decoration:none; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>üñãÔ∏è InkTalk</h1>
      <span class="badge">alpha</span>
    </header>

    <div class="panel">
      <div id="messages" class="messages"></div>
      <div class="toolbar">
        <select id="model">
          <option value="llama3-70b-8192">Llama 3 70B (Groq)</option>
          <option value="llama3-8b-8192">Llama 3 8B (faster)</option>
        </select>
        <textarea id="input" placeholder="Type a message‚Ä¶"></textarea>
        <button id="send" class="primary">Send</button>
      </div>
    </div>
    <div class="footer">
      <div class="muted">Keep it clean. The model still follows provider safety policies.</div>
      <div>
        <button id="clear">Clear</button>
      </div>
    </div>
  </div>

  <script>
    // TODO: replace after deploying the function
    const PROXY_URL = "https://YOUR-NETLIFY-SUBDOMAIN.netlify.app/.netlify/functions/chat";

    const messagesEl = document.getElementById('messages');
    const inputEl = document.getElementById('input');
    const sendBtn = document.getElementById('send');
    const modelEl = document.getElementById('model');
    const clearBtn = document.getElementById('clear');

    let history = JSON.parse(localStorage.getItem('inktalk_history') || '[]');

    function render() {
      messagesEl.innerHTML = '';
      for (const m of history) {
        const row = document.createElement('div');
        row.className = `msg ${m.role}`;
        const role = document.createElement('div');
        role.className = 'role';
        role.textContent = m.role === 'user' ? 'U' : 'A';
        const bubble = document.createElement('div');
        bubble.className = 'bubble';
        bubble.textContent = m.content;
        row.appendChild(role);
        row.appendChild(bubble);
        messagesEl.appendChild(row);
      }
      messagesEl.scrollTop = messagesEl.scrollHeight;
      localStorage.setItem('inktalk_history', JSON.stringify(history));
    }

    async function send() {
      const text = inputEl.value.trim();
      if (!text) return;
      inputEl.value = '';
      sendBtn.disabled = true;

      history.push({ role: 'user', content: text });
      render();

      try {
        const res = await fetch(PROXY_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            model: modelEl.value,
            messages: history.slice(-30) // keep context short for now
          }),
        });
        if (!res.ok) {
          const errText = await res.text();
          throw new Error(`${res.status} ${res.statusText}: ${errText}`);
        }
        const data = await res.json();
        const reply = data.content || data.raw?.choices?.[0]?.message?.content || '(no content)';
        history.push({ role: 'assistant', content: reply });
      } catch (e) {
        history.push({ role: 'assistant', content: `Error: ${e.message}` });
      } finally {
        render();
        sendBtn.disabled = false;
        inputEl.focus();
      }
    }

    sendBtn.addEventListener('click', send);
    inputEl.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); send(); }
    });
    clearBtn.addEventListener('click', () => {
      history = [];
      render();
    });

    render();
  </script>
</body>
</html>
